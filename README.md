# Rapid Narcotics Report System : 신속마약보고체계  

<br>  


마약류를 의료목적이 아닌 다른 목적으로 복용하는 사례가 많아지고 있습니다.   

이러한 마약류 과잉 처방 문제를 줄이고 오남용을 예방하기 위해서 RNRS(Rapid Narcotics Report System, 신속 마약 보고 체계)를 기획했습니다.  


<br>    

***  

<br>  

<p align = 'center'><b>🛠 Tech 🛠</b></p>  

<p align="center">
  <img src="https://img.shields.io/badge/-Python-3776AB?style=flat-square&logo=Python&logoColor=white"/></a>&nbsp 
  <img src="https://img.shields.io/badge/-pandas-150458?style=flat-square&logo=pandas&logoColor=white"/></a>&nbsp
  <img src="https://img.shields.io/badge/-MySQL-4479A1?style=flat-square&logo=MySQL&logoColor=white"/></a>&nbsp   
  <br>  
  <img src="https://img.shields.io/badge/-Plotly-3F4F75?style=flat-square&logo=Plotly&logoColor=white"/></a>&nbsp
  <img src="https://img.shields.io/badge/-Jupyter-F37626?style=flat-square&logo=Jupyter&logoColor=white"/></a>&nbsp
</p>  

<br>  

***  

<br>  

## 01. BackGround  

<br>  

요즘, 유명 연예인과 일반인을 가리지 않고 마약류에 대한 문제가 발생하면서 사회적 물의를 빚고 있습니다. 최근에는 한 유명 연예인이 프로포폴 상습 투약 혐의로 검찰에 입건되었습니다.  


이는 [NIMS(Narcotics information managementsystem, 마약류 통합관리 시스템)](https://data.nims.or.kr/study/intro/view.do)에 의해 적발되었습니다. NIMS 의 빅데이터를 통한 마약 단속 적발률은 2019년 38.9%에 불과했지만, 2022년 68.2%까지 향상된 만큼 마약류 단속에 큰 기여를 하고 있습니다. 분명히 마약 단속에 있어 유의한 결과를 만들고 있지만, 저희는 NIMS 에서 3가지 문제를 도출했습니다.  

<br>  

1. 유통과정이 포함되는 등 데이터 베이스가 너무 복잡하여 환자 개인의 처방 현황을 확인하기에는 많은 시간과 비용을 필요로 합니다. 즉, 예방보다는 현황 파악에 초점이 맞춰진 데이터베이스입니다.  
   
2. 처방 기록이 없는 환자의 명의를 도용해 의사가 다른 환자에게 처방이 가능합니다.  
   
3. 환자가 본인의 투약 이력을 확인하기 위해 '의료용 마약류 빅데이터 활용서비스 및 마약류 안전정보 도우미'를 이용해야하는데, 현재 이런 서비스는 번거롭고 강제성이 부족합니다.  
   
<br>  

저희는 이러한 문제점들을 해결한 마약류 관리 시스템을 만들어 보고자 하였습니다.

<br>  

***  

<br>  

## 02. Objective  

<br>  

위 문제의 해결을 위해 3가지 세부 목적을 기획하였습니다.  

<br>  

<b>1. 데이터베이스 간소화</b>  
 
- 기존의 NIMS 데이터베이스는 유통 과정, 생산 과정 등 여러 테이블을 포함하고 있어 복잡합니다.  
   
- 저희가 제시할 RNRS(Report Narcotics Report system)는 환자와 의사의 관계에만 집중해 빠른 보고 및 환자 모니터링이 가능하게 설계하였습니다. 이를 통해, 예방에 초점을 맞춘 데이터베이스를 구축했습니다.    
 
<br>  

<b>2. 지문 인식을 통한 환자 정보 접근 보안 설정</b>  
   
- 환자의 명의를 도용해 다른 환자에게 처방하는 사례가 많습니다. 이는 병원이 자율적으로 처방량을 기록하여 NIMS 에 보고하기 때문이라고 생각했습니다. 해결을 위해, 지문 인식을 통해 환자가 있어야만 처방 기록을 남길 수 있도록 하여 도용을 어렵게 했습니다.  
   
<br>  

<b>3. 현황 레포트 메일 발송</b>  
   
 
- 현재는, 환자가 본인의 투약 이력을 확인하기 위해 웹에 접속하거나 앱을 다운받아 확인해야 합니다. 하지만 환자의 의지가 없다면 자신의 현황을 확인하지 않을
것입니다.  

- 처방 직후 발송되는 레포트와 시각화 차트를 통해 자신의 투약 이력과 다른 환자들과 비교한 객관적인 건강 상태를 스스로 인지하여 의존성을 줄이고 중독을 예방합니다. 부가적으로, 다른 사람이 허가 없이 자신의 명의를 도용한 경우 이를 즉각적으로 확인할 수 있습니다.  
   
<br>  

***  

<br>  

## 03. Methodology  

<br>  

<b>1. Mysql 데이터베이스 구축</b>  

- 처방 기록 입력을 위해 mysql을 이용해 데이터베이스를 구축하였습니다. mysql같은 관계형 데이터베이스의 핵심은 데이터를 다양한 테이블로 나눠 효율적으로 보관하는 것입니다.  
  
- 환자 정보, 의사 정보, 병원 정보, 처방 기록 등 7개의 테이블로 구성되어 있고, 테이블끼리 primary key와 foreign key로 관계를 맺어주었습니다. 또한 의사가 환자에게 약을 처방하면 병원의 보유량에서 빠지도록 trigger를 설정해주었습니다.  
   
- 데이터베이스는 아래의 구조로 구현하였습니다.  
   

<br>  

<p align="center"><img src="https://user-images.githubusercontent.com/65170165/236972749-e3e4a893-7f1b-455c-9938-4cf010eb1acf.png" height="500px" width="680px"></p>  


<br>  

<b>TABLE 1. doctor_info</b> : 의사 개인 정보 테이블  


| doctorID    | hosID       | dname     | dRNN              | phone            |
|--------------|--------------|-----------|-------------------|------------------|
| 의사 고유 ID | 병원 고유 ID | 의사 이름 | 의사 주민등록번호 | 의사 휴대폰 번호 |  

<br>  


<b>TABLE 2. drug_info</b> : 약물 정보 테이블  

| drugID      | drugname | min         | max         |
|--------------|----------|-------------|-------------|
| 약물 고유 ID | 약물명   | 최소 복용량 | 최대 복용량 |  

<br>  

<b>TABLE 3. patient_info</b> : 환자 정보 테이블  

| patientID   | pname  | pRNN         | phone    | age  |
|--------------|--------|--------------|----------|------|
| 환자 고유 ID | 환자명 | 주민등록번호 | 전화번호 | 나이 |  

<br>  

<b>TABLE 4. hospital</b> : 병원 정보 테이블  

| hosID        | hosnName | hosphone      |
|--------------|----------|---------------|
| 병원 고유 ID | 병원명   | 병원 전화번호 |  

<br>  

<b>TABLE 5. hospital_drug</b> : 병원 약물 보유 현황 테이블  


| hosID        | drugID       | amount         |
|--------------|--------------|----------------|
| 병원 고유 ID | 약물 고유 ID | 약물 보유 현황 |  

<br>  

<b>TABLE 6. prescription_record</b> : 처방전 테이블  

|   patientID  |     hosID    |    drugID    |   doctorID   | prescription_amount |    day   | state | visit_date |
|:------------:|:------------:|:------------:|:------------:|:-------------------:|:--------:|:-----:|:----------:|
| 환자 고유 ID | 병원 고유 ID | 약물 고유 ID | 의사 고유 ID |        처방량       | 처방 일수 |  상태 |  처방 날짜 |  


<br>  

<b>2. Streamlit 웹 페이지 생성</b>  

- 서버보다는 웹을 이용해 GUI를 구성하는 것이 의사가 환자의 데이터를 조회, 입력하는 경우에 편의성이 높을 것입니다.  
 
- streamlit을 사용해 웹을 만들고 pymysql 라이브러리를 이용해서 웹에서 데이터베이스와 연동될 수 있도록 설계하였습니다. 이후, 웹을 통해 복용 현황 레포트가 출력됩니다.  
  
<br>  

<b>3. SMTP 프로토콜 사용</b>  

- 의사가 처방 기록을 입력하게 되면 즉각적으로 메일이 발송되도록 하기 위해 이메일을 주고 받을 수 있는 프로토콜인 SMTP를 사용합니다. python의 smtplib 라이브러리를 통해 본 기능을 구현했습니다.  
   
<br>  

<b>4. 지문 인식 센서 JM-101B 사용</b>  

- 아두이노를 통해 지문인식이 가능하도록 구현했습니다. 의사가 환자에게 약을 투여하거나 처방할 때 환자가 지문을 입력하면 지문과 일치하는 난수 형태의 KEY가 생성됩니다. KEY의 데이터베이스 유무를 확인하고 환자와 일치하면 처방 기록이 가능합니다.  
   
<br>  

***  

<br>  

## 04. Results  

<br>  

원하는 기능을 구현하도록 웹페이지를 구축하였습니다.  

<br>  

<b>1. 로그인 탭</b>  

<p align="center"><img src="https://github.com/nyamin9/RDR_Project/assets/65170165/f8dcff92-83cf-4507-a135-aa228a172cf6" width="1100px"></p>  



초기 Mysql 서버에 의해 읽기 모드 권한이 부여된 의사만이 해당 웹페이지에 로그인이 가능하도록 구현하였습니다.  

<br>  

<br>  

<b>2. 환자 건강상태 파악 탭</b>  

<p align="center"><img src="https://github.com/nyamin9/RDR_Project/assets/65170165/9c96ac08-d765-4736-8f44-53f83b16160e" width="1000px"></p>  

<br>  

Mysql 서버와의 통신을 통해, 현재 진단받고 있는 환자의 처방 이력이 출력되는 페이지입니다. 위 사진의 경우에는 40번 환자의 이력을 보여주고 있습니다.  

<br>  

<br>  

<b>3. 환자 처방기록 입력 탭</b>  


<p align="center"><img src="https://github.com/nyamin9/RDR_Project/assets/65170165/cd8413dd-a918-45cb-bcb9-70898ebc7b84" width="950px"></p>  


처방받는 환자의 ID, 병원ID, 약물ID, 의사ID, 처방량을 입력하면 자동으로 Mysql 서버의 prescription_record 테이블에 업로드되는 탭입니다.  

위 사진의 경우에는 31번 환자에 대한 처방량이 기록되고 있습니다.  


<br>  

<br>  

<b>4. 환자 처방 현황 레포팅 및 차트 시각화 탭</b>  


<p align="center"><img src="https://github.com/nyamin9/RDR_Project/assets/65170165/de2f66d4-4765-46c5-83db-47a120bbef46" width="800px"></p>  


처방받은 환자의 투약 현황에 대한 레포트가 출력되는 탭입니다.  

레포트는 동일 약물 복용 환자들에 대해 다음의 정보를 보여줍니다.  

- 전체 환자 평균 복용량 대비 환자 본인 복용량 평균  
   
- 동일 연령대 환자 평균 복용량 대비 환자 본인 복약량 평균  
   
- 동일 성별 환자 평균 복용량 대비 환자 본인 복욕량 평균  
   
- 환자 본인의 의약품 복용량 추세  
  
<br>  

위 사진의 경우에는 환자 ID가 245번인 환자에 대한 정보를 보여줍니다. 전체 암페타민 복용 환자들의 복용량 평균과 동일 성별 환자들의 평균보다는 낮은 평균 복용량을 보여주고 있지만, 동일 연령대에 비해서는 0.001mg 높은 평균 복용량을 보여줍니다. 아래 추세를 보면 복용량이 감소했다가 증가하는 구간이 반복되고 있기 때문에 적절한 대처와 복용량 처방이 필요할 듯 합니다. 특히 복용량이 감소했다가 증가하는 경우 중독의 위험성이 커질 수 있기에, 유의해야 할 것입니다.  

<br>  

***  

<br>  

## 05. discussion  

<br>  

본 프로젝트를 통해, 다음의 연구 목적을 달성했습니다.  

- 현행 NIMS 데이터베이스 환자-의사 중심 간소화  
 
- 지문 등록 절차를 통한 환자 ID 보안 설정  
 
- 처방과 동시에 이루어지는 현황 레포트 메일 발송  
   
<br>  

위 소기 목적을 통합하여, 본인의 처방 기록 열람을 위해 여러 단계를 거쳐야 했던 기존의 방식 대신 처방 즉시 열람할 수 있는 RNRS를 구축하였습니다. 특히 타 환자 대비 복용량 모니터링을 통해 객관적인 건강 상태를 파악하고 항정신성의약품의 오남용을 예방하여 결과적으로는 마약 중독 자체를 근절하는 효과를 기대합니다.  

<br>  

앞으로의 연구방향으로는 다음의 세부 사항들을 제시합니다.  

- 전반적인 데이터베이스를 간소화했으나, 본 연구에서 제시하는 처방 기록 테이블은 모든 환자와 전체 취급 마약류 의약품의 정보를 포함합니다. 시각화 레포팅을 할 때 환자의취급 약물을 기반으로 데이터를 추출하기 때문에, 현재 연구에서 사용된 테이블을 약물 세그먼트 별로 분류하여 보관하는 방안이 필요할 것입니다.  


<br>  

***  

<br>  


## 프로젝트 템플릿  


<br>  

![image](https://github.com/nyamin9/RDR_Project/assets/65170165/f10792b4-e65d-4b49-ba0b-e881ff121d54)  

<br>  

***  

